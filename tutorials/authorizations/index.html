
<!DOCTYPE html>

<html class="no-js" lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width,initial-scale=1" name="viewport"/>
<meta content="ie=edge" http-equiv="x-ua-compatible"/>
<meta content="Data-Driven Intelligence for the communication and IoT industries" name="description"/>
<link href="https://canyanio.github.io/rating-integration/tutorials/authorizations/" rel="canonical"/>
<meta content="Canyan.io" name="author"/>
<meta content="Copy to clipboard" name="lang:clipboard.copy"/>
<meta content="Copied to clipboard" name="lang:clipboard.copied"/>
<meta content="en" name="lang:search.language"/>
<meta content="True" name="lang:search.pipeline.stopwords"/>
<meta content="True" name="lang:search.pipeline.trimmer"/>
<meta content="No matching documents" name="lang:search.result.none"/>
<meta content="1 matching document" name="lang:search.result.one"/>
<meta content="# matching documents" name="lang:search.result.other"/>
<meta content="[\s\-]+" name="lang:search.tokenizer"/>
<link href="../../favicon.ico" rel="shortcut icon"/>
<meta content="mkdocs-1.0.4, mkdocs-material-4.6.0" name="generator"/>
<title>Authorizations - Canyan Rating</title>
<link href="../../assets/stylesheets/application.1b62728e.css" rel="stylesheet"/>
<link href="../../assets/stylesheets/application-palette.a8b3c06d.css" rel="stylesheet"/>
<meta content="#7e57c2" name="theme-color"/>
<script src="../../assets/javascripts/modernizr.268332fc.js"></script>
<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro,+Helvetica,+sans-serif:300,400,400i,700%7CUbuntu+Mono&amp;display=fallback" rel="stylesheet"/>
<style>body,input{font-family:"Source Sans Pro, Helvetica, sans-serif","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Ubuntu Mono","Courier New",Courier,monospace}</style>
<link href="../../assets/fonts/material-icons.css" rel="stylesheet"/>
<script>
  window.ga = window.ga || function() {
    (ga.q = ga.q || []).push(arguments)
  }
  ga.l = +new Date
  /* Setup integration and send page view */
  ga("create", "UA-141188366-2", "auto")
  ga("set", "anonymizeIp", true)
  ga("send", "pageview")
  /* Register handler to log search on blur */
  document.addEventListener("DOMContentLoaded", () => {
    if (document.forms.search) {
      var query = document.forms.search.query
      query.addEventListener("blur", function() {
        if (this.value) {
          var path = document.location.pathname;
          ga("send", "pageview", path + "?q=" + this.value)
        }
      })
    }
  })
</script>
<script async="" src="https://www.google-analytics.com/analytics.js"></script>
</head>
<body data-md-color-accent="deep-purple" data-md-color-primary="deep-purple" dir="ltr">
<svg class="md-svg">
<defs>
</defs>
</svg>
<input autocomplete="off" class="md-toggle" data-md-toggle="drawer" id="__drawer" type="checkbox"/>
<input autocomplete="off" class="md-toggle" data-md-toggle="search" id="__search" type="checkbox"/>
<label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
<a class="md-skip" href="#authorizations" tabindex="1">
        Skip to content
      </a>
<header class="md-header" data-md-component="header">
<nav class="md-header-nav md-grid">
<div class="md-flex">
<div class="md-flex__cell md-flex__cell--shrink">
<a class="md-header-nav__button md-logo" href="https://canyanio.github.io/rating-integration/" title="Canyan Rating">
<img height="24" src="../../logo.png" width="24"/>
</a>
</div>
<div class="md-flex__cell md-flex__cell--shrink">
<label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
</div>
<div class="md-flex__cell md-flex__cell--stretch">
<div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
<span class="md-header-nav__topic">
              Canyan Rating
            </span>
<span class="md-header-nav__topic">
              
                Authorizations
              
            </span>
</div>
</div>
<div class="md-flex__cell md-flex__cell--shrink">
</div>
</div>
</nav>
</header>
<div class="md-container">
<main class="md-main" role="main">
<div class="md-main__inner md-grid" data-md-component="container">
<div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav class="md-nav md-nav--primary" data-md-level="0">
<label class="md-nav__title md-nav__title--site" for="__drawer">
<a class="md-nav__button md-logo" href="https://canyanio.github.io/rating-integration/" title="Canyan Rating">
<img height="48" src="../../logo.png" width="48"/>
</a>
    Canyan Rating
  </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../.." title="Home">
      Home
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../whats-new/" title="What's New ?">
      What's New ?
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../getting-started/" title="Getting started">
      Getting started
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../running/" title="Running">
      Running
    </a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-toggle md-nav__toggle" data-md-toggle="nav-5" id="nav-5" type="checkbox"/>
<label class="md-nav__link" for="nav-5">
      Agent
    </label>
<nav class="md-nav" data-md-component="collapsible" data-md-level="1">
<label class="md-nav__title" for="nav-5">
        Agent
      </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../agent/agent/" title="Introduction">
      Introduction
    </a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-toggle md-nav__toggle" data-md-toggle="nav-5-2" id="nav-5-2" type="checkbox"/>
<label class="md-nav__link" for="nav-5-2">
      Endpoints
    </label>
<nav class="md-nav" data-md-component="collapsible" data-md-level="2">
<label class="md-nav__title" for="nav-5-2">
        Endpoints
      </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../agent/endpoints/authorization/" title="Authorization">
      Authorization
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../agent/endpoints/transaction-begin/" title="Begin Transaction">
      Begin Transaction
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../agent/endpoints/transaction-end/" title="End Transaction">
      End Transaction
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../agent/endpoints/transaction-record/" title="Record Transaction">
      Record Transaction
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../agent/endpoints/transaction-rollback/" title="Rollback Transaction">
      Rollback Transaction
    </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../hep-agent/" title="HEP Agent">
      HEP Agent
    </a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-toggle md-nav__toggle" data-md-toggle="nav-7" id="nav-7" type="checkbox"/>
<label class="md-nav__link" for="nav-7">
      API
    </label>
<nav class="md-nav" data-md-component="collapsible" data-md-level="1">
<label class="md-nav__title" for="nav-7">
        API
      </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../api/api/" title="Introduction">
      Introduction
    </a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-toggle md-nav__toggle" data-md-toggle="nav-7-2" id="nav-7-2" type="checkbox"/>
<label class="md-nav__link" for="nav-7-2">
      Endpoints
    </label>
<nav class="md-nav" data-md-component="collapsible" data-md-level="2">
<label class="md-nav__title" for="nav-7-2">
        Endpoints
      </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../api/endpoints/carrier/" title="Carrier">
      Carrier
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../api/endpoints/pricelist/" title="Pricelist">
      Pricelist
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../api/endpoints/rate/" title="Rate">
      Rate
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../api/endpoints/account/" title="Account">
      Account
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../api/endpoints/transaction/" title="Transaction">
      Transaction
    </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../engine/" title="Engine">
      Engine
    </a>
</li>
<li class="md-nav__item md-nav__item--active md-nav__item--nested">
<input checked="" class="md-toggle md-nav__toggle" data-md-toggle="nav-9" id="nav-9" type="checkbox"/>
<label class="md-nav__link" for="nav-9">
      Tutorials
    </label>
<nav class="md-nav" data-md-component="collapsible" data-md-level="1">
<label class="md-nav__title" for="nav-9">
        Tutorials
      </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../inserting-data/" title="Inserting Data">
      Inserting Data
    </a>
</li>
<li class="md-nav__item md-nav__item--active">
<input class="md-toggle md-nav__toggle" data-md-toggle="toc" id="__toc" type="checkbox"/>
<label class="md-nav__link md-nav__link--active" for="__toc">
        Authorizations
      </label>
<a class="md-nav__link md-nav__link--active" href="./" title="Authorizations">
      Authorizations
    </a>
<nav class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">Table of contents</label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#prerequisites">
    Prerequisites
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#request">
    Request
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#response">
    Response
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../transactions/" title="Transactions">
      Transactions
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../kamailio-integration/" title="Kamailio Integration">
      Kamailio Integration
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../opensips-integration/" title="Opensips Integration">
      Opensips Integration
    </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../faq/" title="FAQ">
      FAQ
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../license/" title="License">
      License
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../contributing/" title="Contributing">
      Contributing
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../code-of-conduct/" title="Code of conduct">
      Code of conduct
    </a>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">Table of contents</label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#prerequisites">
    Prerequisites
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#request">
    Request
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#response">
    Response
  </a>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-content">
<article class="md-content__inner md-typeset">
<h1 id="authorizations">Authorizations</h1>
<p>The scope of this tutorial is to make your first authorizations with Canyan Rating and how to use this functionality with your own system.
This method is used to get a response from the Rating Engine if the account has the ability to perform the desired transaction before even starting the transaction. A list of unauthorized reasons could be:</p>
<ul>
<li>not found</li>
<li>not active</li>
<li>unreachable destination</li>
<li>too many running transactions</li>
<li>insufficient balance</li>
</ul>
<p>Also if the destination account is handled by the Rating Engine there could be an unauthorized transaction regarding the limitations of the destination account.</p>
<p>There is an immediate response regarding the max available units the account can perform toward that destination and a prioritized list of carriers returned according to the account preferences, LCR etc.</p>
<h2 id="prerequisites">Prerequisites</h2>
<p>The test environment should be set up and running successfully as described in <a href="/running.md">Running Canyan Rating</a> section.
You should have a basic set of data populated in your Canyan Rating instance as described in the <a href="/tutorials/inserting-data/">Inserting Data Tutorial</a>.
The following commands and requests relay on the same data inserted in the above tutorial. If you populated different data you should change the commands in this tutorial accordingly.</p>
<p>It is assumed that the API is running on <code>localhost:8000</code> and the Agent on <code>localhost:8080</code>.</p>
<h2 id="request">Request</h2>
<p>We will now send a request to the Agent component asking for authorization regarding an outbound 
call performed by our account <code>100</code>.</p>
<div class="codehilite"><pre><span></span>curl <span class="s2">"http://localhost:8080/graphql"</span> <span class="se">\</span>
  -X POST <span class="se">\</span>
  -H <span class="s2">"Content-Type: application/json"</span> <span class="se">\</span>
  --data @- <span class="s">&lt;&lt;EOF</span>
<span class="s">{"query": "mutation {</span>
<span class="s">    authorization(</span>
<span class="s">        transaction_tag: \"transaction1\",</span>
<span class="s">        account_tag: \"100\",</span>
<span class="s">        source: \"sip:10.0.0.1:5060\",</span>
<span class="s">        destination: \"39040123123\"</span>
<span class="s">    ) {</span>
<span class="s">        transaction_tag</span>
<span class="s">        account_tag</span>
<span class="s">        authorized</span>
<span class="s">        max_available_units</span>
<span class="s">        balance</span>
<span class="s">        carriers</span>
<span class="s">    }</span>
<span class="s">  }"</span>
<span class="s">}</span>
<span class="s">EOF</span>
</pre></div>
<p>We will use an unique tag for the transaction, will specify the account 
performing the call and will also specify the source of the call and the 
destination the account is trying to reach out to.</p>
<h2 id="response">Response</h2>
<p>The response should be like this:</p>
<div class="codehilite"><pre><span></span>HTTP/1.1 <span class="m">200</span> OK
Content-Type: application/json
<span class="o">{</span>
  <span class="s2">"data"</span>: <span class="o">{</span>
    <span class="s2">"authorization"</span>: <span class="o">{</span> 
      <span class="s2">"transaction_tag"</span>: <span class="s2">"transaction1"</span>,
      <span class="s2">"account_tag"</span>: <span class="s2">"100"</span>,
      <span class="s2">"authorized"</span>: True,
      <span class="s2">"max_available_units"</span>: <span class="m">300</span>
      <span class="s2">"balance"</span>: <span class="m">100</span>
      <span class="s2">"carriers"</span>: <span class="s2">"localhost:5061"</span>
    <span class="o">}</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></div>
<p>The Agent component is responding that for our transaction <code>transaction1</code> 
the account <code>100</code> calling an Italian prefix is allowed to proceed and that 
the max available units for that call are <code>300</code> seconds. The actual balance 
the account has is <code>100</code> and the carrier it is supposed to use is <code>carrier1</code>
available on <code>localhost:5061</code>.</p>
</article>
</div>
</div>
</main>
<footer class="md-footer">
<div class="md-footer-nav">
<nav class="md-footer-nav__inner md-grid">
<a class="md-flex md-footer-nav__link md-footer-nav__link--prev" href="../inserting-data/" rel="prev" title="Inserting Data">
<div class="md-flex__cell md-flex__cell--shrink">
<i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
</div>
<div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
<span class="md-flex__ellipsis">
<span class="md-footer-nav__direction">
                  Previous
                </span>
                Inserting Data
              </span>
</div>
</a>
<a class="md-flex md-footer-nav__link md-footer-nav__link--next" href="../transactions/" rel="next" title="Transactions">
<div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
<span class="md-flex__ellipsis">
<span class="md-footer-nav__direction">
                  Next
                </span>
                Transactions
              </span>
</div>
<div class="md-flex__cell md-flex__cell--shrink">
<i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
</div>
</a>
</nav>
</div>
<div class="md-footer-meta md-typeset">
<div class="md-footer-meta__inner md-grid">
<div class="md-footer-copyright">
<div class="md-footer-copyright__highlight">
            Copyright © 2020 Canyan.io
          </div>
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
</div>
<div class="md-footer-social">
<link href="../../assets/fonts/font-awesome.css" rel="stylesheet"/>
<a class="md-footer-social__link fa fa-github" href="https://github.com/canyanio"></a>
<a class="md-footer-social__link fa fa-twitter" href="https://twitter.com/canyan_io"></a>
<a class="md-footer-social__link fa fa-linkedin" href="https://www.linkedin.com/company/canyan/"></a>
<a class="md-footer-social__link fa fa-slack" href="http://slack.canyan.io"></a>
</div>
</div>
</div>
</footer>
</div>
<script src="../../assets/javascripts/application.808e90bb.js"></script>
<script>app.initialize({version:"1.0.4",url:{base:"../.."}})</script>
<script src="https://unpkg.com/mermaid@7.1.2/dist/mermaid.min.js"></script>
</body>
</html>